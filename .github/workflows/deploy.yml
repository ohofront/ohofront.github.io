# GitHub Pagesì— ì •ì  ì½˜í…ì¸ ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ì›Œí¬í”Œë¡œìš°
name: Deploy static content to Pages

# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´: main ë¸Œëœì¹˜ í‘¸ì‹œ or ìˆ˜ë™ ì‹¤í–‰
on:
  push:
    branches: ["main"]
  workflow_dispatch:

# GitHub Pagesì— ë°°í¬í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ë°°í¬ ì‘ì—… ì¤‘ë³µ ë°©ì§€ (ë™ì‹œì— í•˜ë‚˜ë§Œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •)
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  deploy:
    # ë°°í¬ í™˜ê²½ ì„¤ì • (GitHub Pagesìš©)
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    # GitHub Actionsì—ì„œ ì‚¬ìš©í•  ì„œë²„ í™˜ê²½ ì§€ì •
    runs-on: ubuntu-latest

    steps:
      # 1. ë ˆí¬ì§€í† ë¦¬ ì½”ë“œ ì²´í¬ì•„ì›ƒ (ì½”ë“œ ê°€ì ¸ì˜¤ê¸°)
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Node.js ì„¤ì • (ë²„ì „ 20, npm ìºì‹±)
      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"

      # 3. í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜ (package-lock.json ê¸°ì¤€)
      - name: Install dependencies
        run: npm ci

      # 4. í™˜ê²½ë³€ìˆ˜ íŒŒì¼(.env.production) ìƒì„± (GitHub Secrets ê°’ ì‚½ì…)
      #    ğŸ‘‰ ë°˜ë“œì‹œ build ì´ì „ì— ìœ„ì¹˜í•´ì•¼ Viteê°€ í™˜ê²½ë³€ìˆ˜ ì¸ì‹í•¨
      - name: Create .env.production file
        run: |
          echo "VITE_EMAILJS_PUBLIC_KEY=${{ secrets.VITE_EMAILJS_PUBLIC_KEY }}" >> .env.production
          echo "VITE_EMAILJS_SERVICE_ID=${{ secrets.VITE_EMAILJS_SERVICE_ID }}" >> .env.production
          echo "VITE_EMAILJS_TEMPLATE_ID=${{ secrets.VITE_EMAILJS_TEMPLATE_ID }}" >> .env.production

      # 5. ì •ì  íŒŒì¼ ë¹Œë“œ (Vite production ëª¨ë“œë¡œ í™˜ê²½ë³€ìˆ˜ ì£¼ì…ë¨)
      - name: Build
        run: npm run build -- --mode production

      # 6. GitHub Pages ì„¤ì • êµ¬ì„±
      - name: Setup Pages
        uses: actions/configure-pages@v4

      # 7. ë¹Œë“œëœ ê²°ê³¼ë¬¼(dist í´ë”)ì„ Pages Artifactë¡œ ì—…ë¡œë“œ
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: "./dist"

      # 8. GitHub Pagesì— ìµœì¢… ë°°í¬
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
